INSERT INTO transforms (category_id, slug, name, description, icon, tier, overview, tag)
VALUES (
    5,
    'lottie',
    'Lottie',
    'Lottie animations from JSON files with playback controls.',
    'animation',
    'pro',
    $$Play Lottie animations from JSON files. Powered by lottie-web, the official Airbnb library for rendering After Effects animations on the web.

### How it works

Point to any Lottie JSON URL and get a smooth, scalable animation that renders as SVG by default. Lottie files are tiny compared to video or GIF - a complex animation might be just 20-50KB. They scale to any size without losing quality, which makes them perfect for icons, illustrations, loading states, and hero sections.

### Triggers

By default, animations autoplay and loop continuously. But you can control when they start with three different trigger modes.

Scroll trigger plays the animation when it enters the viewport - good for illustrations that should animate as the user scrolls down. Hover trigger starts the animation when the mouse enters the element, with two modes: play (starts on enter, pauses on leave) and reverse (plays forward on enter, plays backward on leave). Click trigger lets users tap to toggle playback or restart the animation from the beginning.

### Playback

Speed and direction can be adjusted independently. Slow an animation down to half speed for a more relaxed feel, or double it for energy. Reverse direction plays the whole animation backward, which works surprisingly well for some transitions.

### Renderers

SVG is the default and best for most cases - sharp at any size, accessible, and lightweight. Canvas is available for performance-heavy animations with lots of layers. HTML renderer is an option but rarely needed.$$,
    NULL
)
RETURNING id;

-- Use the returned id as {transform_id} below:

INSERT INTO versions (transform_id, version, code, style, js, css, config, usage, previews)
VALUES (
    {transform_id},
    '1.0.0',
    $$const prefix = 'ot-lottie';

if(!data['path'])
{
    return;
}

this.build = () =>
{
    node.classList.add(prefix);
    node.innerHTML = '';

    const container = document.createElement('div');
    container.className = prefix + '-container';
    node.appendChild(container);

    this.instance = lottie.loadAnimation({
        container: container,
        renderer: data['renderer'],
        loop: data['loop'],
        autoplay: data['trigger'] === 'none' && data['autoplay'],
        path: data['path']
    });

    this.instance.setSpeed(data['speed']);
    this.instance.setDirection(data['direction']);
};

this.trigger = () =>
{
    const trigger = data['trigger'];

    if(trigger === 'scroll')
    {
        this.observer = new IntersectionObserver((entries) =>
        {
            if(entries[0].isIntersecting)
            {
                this.instance.play();
                if(!data['loop'])
                {
                    this.observer.disconnect();
                }
            }
            else
            {
                this.instance.pause();
            }
        }, { threshold: 0.2 });
        this.observer.observe(node);
    }
    else if(trigger === 'hover')
    {
        this.instance.pause();

        node.addEventListener('mouseenter', () =>
        {
            if(data['hover-action'] === 'play')
            {
                this.instance.play();
            }
            else if(data['hover-action'] === 'reverse')
            {
                this.instance.setDirection(1);
                this.instance.play();
            }
        });

        node.addEventListener('mouseleave', () =>
        {
            if(data['hover-action'] === 'play')
            {
                this.instance.pause();
            }
            else if(data['hover-action'] === 'reverse')
            {
                this.instance.setDirection(-1);
                this.instance.play();
            }
        });
    }
    else if(trigger === 'click')
    {
        this.instance.pause();
        this.playing = false;

        node.addEventListener('click', () =>
        {
            if(data['click-action'] === 'toggle')
            {
                this.playing = !this.playing;
                this.playing ? this.instance.play() : this.instance.pause();
            }
            else if(data['click-action'] === 'restart')
            {
                this.instance.goToAndPlay(0, true);
            }
        });
    }
};

this.build();
this.trigger();$$,
    $$.ot-lottie {
    display: flex;
    align-items: center;
    justify-content: center;
}

.ot-lottie-container {
    width: 100%;
    height: 100%;
}

.ot-lottie-container svg {
    display: block;
}$$,
    ARRAY['https://cdn.jsdelivr.net/npm/lottie-web@5.13.0/build/player/lottie.min.js'],
    NULL,
    '{"path": {"type": "string", "value": "", "description": "URL to Lottie JSON file"}, "loop": {"type": "boolean", "value": true, "description": "Whether to loop the animation"}, "autoplay": {"type": "boolean", "value": true, "description": "Whether to autoplay on load"}, "speed": {"type": "number", "value": 1, "description": "Playback speed multiplier"}, "direction": {"type": "number", "value": 1, "description": "Playback direction - 1 for forward, -1 for reverse"}, "renderer": {"type": "string", "value": "svg", "description": "Render mode - svg, canvas, or html"}, "trigger": {"type": "string", "value": "none", "description": "Trigger mode - none, scroll, hover, or click"}, "hover-action": {"type": "string", "value": "play", "description": "Hover behavior - play or reverse"}, "click-action": {"type": "string", "value": "toggle", "description": "Click behavior - toggle or restart"}}'::jsonb,
    $$<div ot="lottie" ot-path="https://assets2.lottiefiles.com/packages/lf20_UJNc2t.json" style="width: 200px; height: 200px;"></div>$$,
    ARRAY[
        $$// Autoplay
<style>
    .autoplay { display: flex; justify-content: center; gap: var(--ot-spacing-l); padding: var(--ot-spacing-l) var(--ot-spacing-m); }
    .autoplay .animation { width: 200px; height: 200px; }
</style>

<div class="autoplay">
    <div ot="lottie" ot-path="https://assets2.lottiefiles.com/packages/lf20_UJNc2t.json" class="animation"></div>
    <div ot="lottie" ot-path="https://assets9.lottiefiles.com/packages/lf20_jcikwtux.json" class="animation"></div>
</div>$$,
        $$// Hover
<style>
    .hover { display: flex; justify-content: center; gap: var(--ot-spacing-l); padding: var(--ot-spacing-l) var(--ot-spacing-m); }
    .hover .animation { width: 200px; height: 200px; cursor: pointer; }
    .hover .label { text-align: center; color: var(--ot-text-2); font-size: var(--ot-size-s); margin-top: var(--ot-spacing-s); }
</style>

<div class="hover">
    <div>
        <div ot="lottie" ot-path="https://assets2.lottiefiles.com/packages/lf20_UJNc2t.json" ot-trigger="hover" ot-hover-action="play" class="animation"></div>
        <div class="label">Hover to play</div>
    </div>
    <div>
        <div ot="lottie" ot-path="https://assets9.lottiefiles.com/packages/lf20_jcikwtux.json" ot-trigger="hover" ot-hover-action="reverse" class="animation"></div>
        <div class="label">Hover to reverse</div>
    </div>
</div>$$,
        $$// Scroll
<style>
    .scroll { display: flex; justify-content: center; padding: var(--ot-spacing-l) var(--ot-spacing-m); }
    .scroll .animation { width: 200px; height: 200px; }
</style>

<div class="scroll">
    <div ot="lottie" ot-path="https://assets9.lottiefiles.com/packages/lf20_jcikwtux.json" ot-trigger="scroll" ot-loop="false" class="animation"></div>
</div>$$
    ]
);
